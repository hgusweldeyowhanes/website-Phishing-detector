{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Phishing URL Detector</title>
    <link rel="stylesheet" type="text/css" href="{% static 'style.css' %}">
</head>
<body>

<div class="container main-body">
    <div class="form abc">
        <h2>PHISHING URL DETECTION</h2>
        <br>
        <textarea id="url-input" class="form__input" placeholder="Enter URLs here" style="width:450px; height:15px;"></textarea><br>
        <button class="button" id="check-btn" onclick="checkUrls()">Check URLs</button>
        <div id="results" style="margin-top:20px;"></div>
    </div>
</div>

<script>
async function checkUrls() {
    const input = document.getElementById('url-input').value;
    const urls = input.split('\n').map(u => u.trim()).filter(u => u);

    if(urls.length === 0) {
        alert("Please enter at least one URL.");
        return;
    }

    try {
        const response = await fetch("/check-url/", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ url: urls })
        });
        const data = await response.json();
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = "";

        for (const url in data){
            const p = data[url];
            const isPhishing = p.prediction === "Phishing";
            const color = isPhishing ? "#ee3737" : "#37ee65"; // red for phishing, green for safe
            const messageDiv = document.createElement('div');
            messageDiv.style.padding = "10px";
            messageDiv.style.marginBottom = "5px";
            messageDiv.style.borderRadius = "5px";
            messageDiv.style.backgroundColor = color;
            messageDiv.style.color = "#000";
            messageDiv.innerHTML = `<p>${p.message}</p>
                                    <button style="margin-top:5px; padding:5px 10px;" onclick="window.open('${url}', '_blank')">Continue</button>`;
            resultsDiv.appendChild(messageDiv);
        }
    } catch (error) {
        alert("Error: " + error);
    }
}
</script>

</body>
</html>
